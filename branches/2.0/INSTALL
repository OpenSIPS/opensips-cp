OpenSIPS Control Panel (OCP) Installation Guide 
-----------------------------------------------


OCP was tested and developed mostly on Debian Linux , but of course it works
with other Linux distros as well. Some of the paths and commands in this INSTALL 
guide might be debian specific.   



You will need apache , php and a mysql server for OCP to work.

Apache
------

1. You need to add this entry in your httpd.conf (or apache.conf) :

Alias /cp /var/www/opensips-cp/web



If you want to use another webserver , note the OCP has been tested only 
on apache and lighthttpd.


2. Make ocp's access.log file writeable by apache :

chown www-data.www-data /var/www/opensips-cp/config/access.log

You might be not running debian, so check out the user and the group apache is
running on (I believe www-data is debian specific).




PHP 
---


You must have PHP installed end enabled in the web server.
The MySQL support  and  XMLRPC support in PHP must be enabled. 

1. php-mysql package must be installed and the mysql module loaded in php.ini
You must have this line into your php.ini:
extension=mysql.so

2. php-xmlrpc package must be installed and the xmlrpc module loaded in php.ini.
You must have this line into your php.ini:
extension=xmlrpc.so

A must-have option to be set into your php.ini :

short_open_tag = On ;  


MySQL server 
------------

The OpenSIPS Control Panel can connect to a remote database server, 
so the MySQL server can be used from the SIP Server machine or another 
machine in the network.



* MySQL v4.1+ must be installed . If you plan to use the the cdrviewer tool you will need Mysql 5. 
The cdrviewer tool uses a mysql stored procedure, and there is no stored procedures support into Mysql 4.


* You will need the opensips database schema from the opensips distribution. (www.opensips.org) 
(OCP is made for it)


* Additional steps:

    * For the cdrviewer tool you must add a table and a stored procedure to the OpenSIPS database.

    Follow these steps:	
     
	1 . install the cdr table schema cdrs.sql 
	(opensips-cp/config/tools/cdrviewer/cdrs.sql)
	mysql -Dopensips -p < cdrs.sql 

	2. install opensips_cdrs_1_5.sql , a mysql stored procedure that generates cdr records
	from the acc table :  
	
	mysql -Dopensips -p < opensips_cdrs_1_5.sql     
	
	3. edit the cron_job/generate-cdrs.sh file and change the mysql connection data
	(hostname,username,password and database)
	
	4. you will need to call this procedure from cron at an arbitrary interval.
	Here's a cron entry for a 3 minutes interval:
	
	*/3 * * * * root /var/www/opensips-cp/cron_job/generate-cdrs.sh
		
	
    * For the smonitor module : you must add two tables to the OpenSIPS database .

    Follow these steps:	
    
	1. Install the monitored_stats.sql and monitoring_stats.sql tables. 
	You will find them in :
		
	opensips-cp/config/tools/cdrviewer/tables.sql	
	This is where the smonitor tool of the panel stores data.
	
	    
	2. Add a cron job that collects data from the opensips machine(s).
	
	Here's a cron job that collects data at 1 minute interval:
	(This interval is not arbitrary , it must be set at 1 minute , so is the smonitor tool designed )
	
	* * * * *   root   php /var/www/opensips-cp/cron_job/get_opensips_stats.php > /dev/null
	
	
	The cron jobs do not need to run as root, you might want to change the user.
	
Configuration files
-------------------

Configuration files are split in:
        1) global(config/db.inc.php)
        2) local(config/tools/module_name/db.inc.php)

NOTE: If all modules pull out data from the same database, there should be used only the global config file and the local config files should be left as they are defined by default.
      If modules draw out data from different databases, in the local config files all the fields should be left uncommented ( host, database name, port(if necessary) user, password ).

The 2 types of files (global and local) are identical.	
